{
    "sourceFile": "pages/password/verify-reset-password.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1736741923663,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1736741923663,
            "name": "Commit-0",
            "content": "import { useState } from 'react'; \r\nimport { useRouter } from 'next/router';\r\nimport { Button } from 'primereact/button';\r\nimport { InputText } from 'primereact/inputtext';\r\nimport { classNames } from 'primereact/utils';\r\nimport axios from 'axios';\r\n\r\nconst VerifyResetPassword = () => {\r\n    const [otp, setOtp] = useState('');\r\n    const [notification, setNotification] = useState({ type: '', message: '' });\r\n    const router = useRouter();\r\n    const { token, email } = router.query; // Assuming the token and email are in the query parameters\r\n\r\n    const handleVerify = async () => {\r\n        setNotification({ type: '', message: '' }); // Reset notification\r\n\r\n        if (otp.length !== 4 || isNaN(otp)) {\r\n            setNotification({ type: 'error', message: 'PIN must be a 4-digit number.' });\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const response = await axios.post(\r\n                `http://192.168.14.248:2356/api/auth/verify-reset?token=${token}`,\r\n                { otp },\r\n                {\r\n                    headers: {\r\n                        'X-Api-Key': '3f=Pr#g1@RU-nw=30'  // Adding the custom API key header\r\n                    }\r\n                }\r\n            );\r\n\r\n            if (response.status === 200) {\r\n                const data = response.data;\r\n                setNotification({ type: 'success', message: 'PIN verified successfully!' });\r\n                setTimeout(() => {\r\n                    router.push(`/password/reset-password?token=${data.data.token}`);  // Pass token as a query parameter\r\n                }, 2000);\r\n            } else {\r\n                handleVerifyError(response);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error during verification:', error);\r\n            setNotification({ type: 'error', message: 'An unexpected error occurred.' });\r\n        }\r\n    };\r\n\r\n    const handleVerifyError = async (response) => {\r\n        const errorMessage = response?.data?.meta?.message || response?.data?.error || 'Verification failed.';\r\n        setNotification({ type: 'error', message: errorMessage });\r\n    };\r\n\r\n    // Resend OTP request\r\n    const handleResendOtp = async () => {\r\n        setNotification({ type: '', message: '' }); // Reset notification\r\n\r\n        try {\r\n            const response = await axios.post(\r\n                `http://192.168.14.248:2356/api/auth/resend-reset?token=${token}`, \r\n                { email },\r\n                {\r\n                    headers: {\r\n                        'X-Api-Key': '3f=Pr#g1@RU-nw=30'  // Adding the custom API key header\r\n                    }\r\n                }\r\n            );\r\n\r\n            if (response.status === 200) {\r\n                setNotification({ type: 'success', message: 'PIN has been resent to your email!' });\r\n            } else {\r\n                setNotification({ type: 'error', message: 'Failed to resend PIN.' });\r\n            }\r\n        } catch (error) {\r\n            console.error('Error during resend:', error);\r\n            setNotification({ type: 'error', message: 'An error occurred while resending the PIN.' });\r\n        }\r\n    };\r\n\r\n    const containerClassName = classNames(\r\n        'surface-ground flex align-items-center justify-content-center min-h-screen min-w-screen overflow-hidden'\r\n    );\r\n\r\n    return (\r\n        <div className={containerClassName}>\r\n            <div className=\"flex flex-column align-items-center justify-content-center\">\r\n                <div\r\n                    style={{\r\n                        borderRadius: '56px',\r\n                        padding: '0.3rem',\r\n                        background: 'linear-gradient(180deg, var(--primary-color) 10%, rgba(33, 150, 243, 0) 30%)',\r\n                    }}\r\n                >\r\n                    <div className=\"w-full surface-card py-8 px-5 sm:px-8\" style={{ borderRadius: '53px' }}>\r\n                        <div className=\"text-center mb-5\">\r\n                            <div className=\"text-900 text-2xl font-medium mb-2\">Verify PIN</div>\r\n                            <p className=\"text-600\">Enter the 4-digit PIN sent to your email to proceed.</p>\r\n                            {notification.message && (\r\n                                <div\r\n                                    className={classNames(\r\n                                        'p-2 rounded text-center mb-3',\r\n                                        notification.type === 'error' ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'\r\n                                    )}\r\n                                    style={{ fontSize: '0.9rem' }}\r\n                                >\r\n                                    {notification.message}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label htmlFor=\"otp\" className=\"block text-900 text-lg font-medium mb-2\">\r\n                                PIN Code\r\n                            </label>\r\n                            <InputText\r\n                                id=\"otp\"\r\n                                type=\"text\"\r\n                                value={otp}\r\n                                onChange={(e) => setOtp(e.target.value.replace(/\\D/g, ''))} // Allow only digits\r\n                                maxLength={4}\r\n                                className=\"w-full\"\r\n                                style={{ padding: '0.75rem', fontSize: '1rem', textAlign: 'center', letterSpacing: '0.5rem' }}\r\n                                placeholder=\"****\"\r\n                            />\r\n                            <Button\r\n                                className=\"w-full mt-4\"\r\n                                style={{\r\n                                    padding: '0.75rem',\r\n                                    fontSize: '1rem',\r\n                                    fontWeight: 'bold',\r\n                                }}\r\n                                onClick={handleVerify}\r\n                            >\r\n                                Verify PIN\r\n                            </Button>\r\n                            <div className=\"text-center mt-4\">\r\n                                <span className=\"text-600\">Didn't receive the PIN? </span>\r\n                                <button\r\n                                    className=\"font-medium\"\r\n                                    style={{ color: 'var(--primary-color)', textDecoration: 'underline', background: 'none', border: 'none', cursor: 'pointer' }}\r\n                                    onClick={handleResendOtp} // Resend OTP function\r\n                                >\r\n                                    Resend PIN\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nVerifyResetPassword.getLayout = function getLayout(page) {\r\n    return page;\r\n};\r\n\r\nexport default VerifyResetPassword;\r\n"
        }
    ]
}