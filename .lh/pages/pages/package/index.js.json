{
    "sourceFile": "pages/pages/package/index.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1736741923710,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1736741923710,
            "name": "Commit-0",
            "content": "import React, { useState } from 'react';\r\nimport { Button } from 'primereact/button';\r\nimport { InputText } from 'primereact/inputtext';\r\nimport Cookies from 'js-cookie';\r\nimport Link from 'next/link';\r\n    \r\nconst Package = () => {\r\n    const [paymentToken, setPaymentToken] = useState(null);\r\n    const [formData, setFormData] = useState({\r\n        email: '',\r\n        first_name: '',\r\n        last_name: '',\r\n        gross_amount: 1,\r\n    });\r\n\r\n    const getTokenFromCookie = () => Cookies.get('token');\r\n\r\n    const handleChange = (e) => {\r\n        const { name, value } = e.target;\r\n        setFormData((prevData) => ({\r\n            ...prevData,\r\n            [name]: value,\r\n        }));\r\n    };\r\n\r\n    const fetchPaymentToken = async () => {\r\n        const token = getTokenFromCookie();\r\n        try {\r\n            const response = await fetch('http://192.168.14.248:2358/api/merchant/packages/create', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    Authorization: `Bearer ${token}`,\r\n                },\r\n                body: JSON.stringify(formData),\r\n            });\r\n    \r\n            const data = await response.json();\r\n            if (data.status && data.data.token) {\r\n                console.log('Token fetched:', data.data.token); // Log untuk memastikan token benar\r\n                setPaymentToken(data.data.token); // Simpan token untuk digunakan di Snap.js\r\n            } else {\r\n                console.error('Invalid response:', data);\r\n                alert('Gagal mengambil token pembayaran');\r\n            }\r\n        } catch (error) {\r\n            console.error('Error fetching payment token:', error);\r\n            alert('Gagal mengambil token pembayaran, periksa koneksi Anda');\r\n        }\r\n    };\r\n    \r\n\r\n    const handleMidtransPayment = () => {\r\n        if (!paymentToken) {\r\n            alert('Token pembayaran tidak tersedia. Coba klik PAY lagi.');\r\n            return;\r\n        }\r\n\r\n        if (window.snap) {\r\n            window.snap.pay(paymentToken, {\r\n                onClose: function () {\r\n                    alert('Jendela pembayaran Midtrans ditutup.');\r\n                },\r\n            });\r\n        } else {\r\n            alert('Snap.js belum terinisialisasi!');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"grid\">\r\n            <div className=\"col-12 md:col-6\">\r\n                <div className=\"card p-fluid\">\r\n                    <div className=\"field\">\r\n                        <label htmlFor=\"email\">Email</label>\r\n                        <InputText\r\n                            id=\"email\"\r\n                            name=\"email\"\r\n                            value={formData.email}\r\n                            onChange={handleChange}\r\n                            placeholder=\"Email\"\r\n                        />\r\n                    </div>\r\n                    <div className=\"field\">\r\n                        <label htmlFor=\"first_name\">First Name</label>\r\n                        <InputText\r\n                            id=\"first_name\"\r\n                            name=\"first_name\"\r\n                            value={formData.first_name}\r\n                            onChange={handleChange}\r\n                            placeholder=\"First Name\"\r\n                        />\r\n                    </div>\r\n                    <div className=\"field\">\r\n                        <label htmlFor=\"last_name\">Last Name</label>\r\n                        <InputText\r\n                            id=\"last_name\"\r\n                            name=\"last_name\"\r\n                            value={formData.last_name}\r\n                            onChange={handleChange}\r\n                            placeholder=\"Last Name\"\r\n                        />\r\n                    </div>\r\n                    <Button\r\n                        label=\"PAY\"\r\n                        onClick={async () => {\r\n                            await fetchPaymentToken(); // Dapatkan token sebelum membuka Snap\r\n                            handleMidtransPayment(); // Lanjutkan dengan pembayaran jika token berhasil didapatkan\r\n                        }}\r\n                        className=\"p-button-success\"\r\n                    />\r\n                </div>\r\n            </div>\r\n            \r\n            <div className=\"col-12 md:col-6\">\r\n                <div className=\"card p-fluid\" style={{ backgroundColor: '#fff', padding: '1rem', borderRadius: '8px' }}>\r\n                    <h5 style={{ color: '#000', marginBottom: '1rem' }}>Order Summary</h5>\r\n                    <div className=\"field grid align-items-center\">\r\n                        <div className=\"col-6\">\r\n                            <h5 style={{ color: '#000', margin: 0 }}>Subtotal</h5>\r\n                        </div>\r\n                        <div className=\"col-6 text-right\">\r\n                            <h5 style={{ color: '#000', margin: 0 }}>Rp.49,000</h5>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"field grid align-items-center\">\r\n                        <div className=\"col-6\">\r\n                            <h5 style={{ color: '#000', margin: 0 }}>PPN @ 11.00%</h5>\r\n                        </div>\r\n                        <div className=\"col-6 text-right\">\r\n                            <h5 style={{ color: '#000', margin: 0 }}>Rp.23,650</h5>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <hr style={{ borderColor: '#000', opacity: 0.2, margin: '1rem 0' }} />\r\n\r\n                    <div className=\"field grid align-items-center\">\r\n                        <div className=\"col-6\">\r\n                            <h5 style={{ color: '#000', margin: 0 }}>Total Monthly</h5>\r\n                        </div>\r\n                        <div className=\"col-6 text-right\">\r\n                            <h5 style={{ color: '#000', margin: 0 }}>\r\n                                Rp{formData.gross_amount.toLocaleString('id-ID')}\r\n                            </h5>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n           \r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Package;\r\n"
        }
    ]
}